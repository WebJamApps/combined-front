machine:
  node:
    version: 8.5.0
dependencies:
  pre:
    - curl -s https://raw.githubusercontent.com/chronogolf/circleci-google-chrome/master/use_chrome_stable_version.sh | bash
    - npm install -g yarn codeclimate-test-reporter
  override:
    - yarn install
    - npm run postinstall:backend

general:
  artifacts:
    - ./coverage
test:
  post:
    - codeclimate-test-reporter < coverage/lcov.info

deployment:
  master:
    branch: master
    commands:
      - curl -v -X DELETE https://circleci.com/api/v1.1/project/github/WebJamApps/web-jam-back/build-cache?circle-token=$TRIGGER_TOKEN
      - curl -v -X POST https://circleci.com/api/v1.1/project/github/WebJamApps/web-jam-back/tree/master?circle-token=$TRIGGER_TOKEN
  dev:
    branch: dev
    commands:
      - curl -v -X DELETE https://circleci.com/api/v1.1/project/github/WebJamApps/web-jam-back/build-cache?circle-token=$TRIGGER_TOKEN
      - curl -v -X POST https://circleci.com/api/v1.1/project/github/WebJamApps/web-jam-back/tree/dev?circle-token=$TRIGGER_TOKEN
